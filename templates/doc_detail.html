{% extends 'base.html' %}

{% block doc %}
    <!-- Защита от прямого доступа к Документу -->

    {% comment %}{% if current_doc.company.id in user_companies and (user.id == current_doc.author or is_member) %}{% endcomment %}
    {% if user.id == current_doc.author.id or is_member or user.id == current_doc.manager.id %}

        <div class="object-detail">
            <div>
                <div class="object-detail-header">
                    <!--<div class="circle-left"></div><div class="circle-right"></div>-->
                    <h3>{{ current_doc.name }} <em style="font-size: 70%;">(версия {{ current_docver }})</em>
                        {% if not current_doc.is_active %}
                            (Документ перемещён в архив)
                        {% endif %}
                    </h3>
                </div>
                <div class="object-detail-left">
                    <p>{% autoescape off %}{{ current_doc.description }}{% endautoescape %}</p><br />
                    <i><p>Организация: <span class="hint hint--bottom hint--info" data-hint="Документы организации"><a href="{% url 'my_doc:docs' current_doc.company.pk 0 %}">{{ current_doc.company }}</a></span></p></i>
                    <p>Менеджер: <span class="hint hint--bottom hint--info" data-hint="Профиль"><a href="{% url 'my_account:userprofile_detail' current_doc.manager.pk ' ' %}">{{ current_doc.manager }}</a></span></p>
                    <!--<p>Создан: {{ current_doc.datecreate }}</p>
                    <p>Закрыт: {{ current_doc.dateclose }}</p>-->
                    <p>Тип: {{ current_doc.type }}</p>
                    <p>Статус: {{ current_doc.status }}</p>
                    <p><i>Участники:
                        {% for u in current_doc.members.all %}
                            <span class="hint hint--bottom hint--info" data-hint="Профиль"><a href="{% url 'my_account:userprofile_detail' u.pk ' ' %}">{{ u.username }}</a>,</span>&nbsp;
                        {% endfor %}
                    </i></p>
                    <em>Автор: {{ current_doc.author }}</em><br />
                    <!--<em>Участники: { current_doc.members.name }}</em><br /> -->
                    <em>Дата: {{ current_doc.datecreate }}</em>
                    <p>&nbsp;</p>
                </div>
                <div class="object-detail-right">
                    {% include 'objectfile_list.html' %}
                </div>
            </div>

            <!--{ if user.is_authenticated and user.id == current_doc.author_id  %}-->
            <div class="object-detail-buttons">
                <!--<a href="{% url 'my_doc:doc_create' current_doc.company.id %}">{{ button_doc_create }}</a>-->
                <a href="{% url 'my_doc:doc_update' current_doc.pk %}">{{ button_doc_update }}</a>
                <!--<a href="{ url 'my_doc:doc_history' current_doc.pk %}">{ button_doc_history }}</a>-->
                <a href="{% url 'my_main:object_history' 'doc' current_doc.pk %}">{{ button_doc_history }}</a>
            </div>
            <!--{ endif %}-->

        </div>

    {% else %}

        <h4>Информация о Документе недоступна!</h4> <!--{ current_company.id }}/{ user_companies }}-->

    {% endif %}

{% endblock doc %}

{% block list %}
    <!-- Защита от прямого доступа к задачам Документа -->
    {% comment %}{% if current_doc.company.id in user_companies %}{% endcomment %}
    {% if user.id == current_doc.author.id or is_member or user.id == current_doc.manager.id %}

        <div class="object-list">

            <h4>Движение Документа</h4>

             <form method="GET">
                {% csrf_token %}
                <div class="object-list-filters">
                   <label>По статусу: </label>
                   <select name="select_taskstatus" id="statusselectid" class="select-task-status">
                      <option value="-1" {% ifequal "-1" tskstatus_selectid %} selected="selected" {% endifequal %}>- Все</option>
                      <option value="0" {% ifequal 0 tskstatus_selectid|add:"0" %} selected="selected" {% endifequal %}>- Все активные</option>
                      <option value="-2" {% ifequal "-2" tskstatus_selectid %} selected="selected" {% endifequal %}>- Просроченные</option>
                      {% for tskstatus in taskstatus %}
                         <option value="{{tskstatus.id}}" {% ifequal tskstatus.id tskstatus_selectid|add:"0" %} selected="selected" {% endifequal %}>
                            {{tskstatus.name}}
                         </option>
                      {% endfor %}
                   </select>
                   <label>По типу: </label>
                   <select name="select-tasktype" id="typeselectid" class="select-task-type">
                      <option value="-1" {% ifequal "-1" tsktype_selectid %} selected="selected" {% endifequal %}>- Все</option>
                      {% for tsktype in tasktype %}
                         <option value="{{tsktype.id}}" {% ifequal tsktype.id tsktype_selectid|add:"0" %} selected="selected" {% endifequal %}>
                            {{tsktype.name}}
                         </option>
                      {% endfor %}
                   </select>
                    {% comment %}
                   <label>Мои: </label>
                   <select name="select-mytask" id="myselectid" class="select-my-task">
                      <option value="-1" {% ifequal "-1" tskstatus_myselectid %} selected="selected" {% endifequal %}>- Все</option>
                      <option value="0" {% ifequal "0" tskstatus_myselectid %} selected="selected" {% endifequal %}>- Я участник</option>
                      <option value="1" {% ifequal "1" tskstatus_myselectid %} selected="selected" {% endifequal %}>- Я автор</option>
                      <option value="2" {% ifequal "2" tskstatus_myselectid %} selected="selected" {% endifequal %}>- Я исполнитель</option>
                   </select>
                   {% endcomment %}
                   <button id="selection-button" type="submit" method="GET" class="object-filter-button">Применить</button>
                   <!--<button type="submit">Применить</button>-->
                </div>
             </form>

            <!--<div class="object-list">
                { include 'doctasks_list.html' %}
            </div>-->
            <div id="ajax_doctasklistresult">{% include 'doctasks_list.html' %}</div>
            <div id="ajax_doctasklisterrors"></div>

            <div class="object-list-buttons">
                <a href="{% url 'my_doc:doctask_create' current_doc.id current_doc.docver %}">{{ button_task_create }}</a>
            </div>

        </div>

    {% else %}
        <h5>Информация о движении Документа недоступна!</h5>
    {% endif %}

{% endblock list %}
   